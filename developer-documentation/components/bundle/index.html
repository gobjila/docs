<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.backbee.com/developer-documentation/components/bundle/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">

        <title>Bundle - The BackBee documentation</title>

        <link href="../../../css/gen.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-3459992-27', 'docs.backbee.com');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../.."><img src="../../../img/logo-bb-docs.png" alt="The BackBee documentation" title="The BackBee documentation" height="28" style="vertical-align:bottom;" /> <b>Documentation</b></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">Introduction</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../requirements/">Requirements</a>
                        </li>
                    
                        <li >
                            <a href="../../installation/">Installation</a>
                        </li>
                    
                        <li >
                            <a href="../../architecture/">Architecture</a>
                        </li>
                    
                        <li >
                            <a href="../../configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../../project_architecture/">Project Architecture</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbooks <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../cookbooks/create_bundle_administration/">Create bundle administration</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/create_new_commands/">Create new commands</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/create_new_templating_helpers/">Create new templating helpers</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/customize_error_pages/">Customize error pages</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/ease_debugging_with_profiler/">Ease debugging with the Web Profiler</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/use_swift_mailer_in_backbee/">Use Swift Mailer in BackBee</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/layout_creation/">Layout creation using LayoutBuilderBundle</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li class="active">
                            <a href="./">Bundle</a>
                        </li>
                    
                        <li >
                            <a href="../cache/">Cache</a>
                        </li>
                    
                        <li >
                            <a href="../classcontent/">ClassContent</a>
                        </li>
                    
                        <li >
                            <a href="../config/">Config</a>
                        </li>
                    
                        <li >
                            <a href="../event_listener/">Event Listener</a>
                        </li>
                    
                        <li >
                            <a href="../nested_node/">Nested Node</a>
                        </li>
                    
                        <li >
                            <a href="../renderer/">Renderer</a>
                        </li>
                    
                        <li >
                            <a href="../routing/">Routing</a>
                        </li>
                    
                        <li >
                            <a href="../security/">Security</a>
                        </li>
                    
                        <li >
                            <a href="../translation/">Translation</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../../cookbooks/layout_creation/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../cache/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/backbee/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container" id="main-container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#components">Components</a></li>
        
            <li><a href="#the-bundle-component">The Bundle Component</a></li>
        
            <li><a href="#what-is-a-bundle">What is a bundle?</a></li>
        
            <li><a href="#bundle-folder-structure-and-entry-point">Bundle folder structure and entry point</a></li>
        
            <li><a href="#how-the-bundle-loader-works">How the bundle loader works?</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
                

<h1 id="components">Components</h1>
<h2 id="the-bundle-component">The Bundle Component</h2>
<h2 id="what-is-a-bundle">What is a bundle?</h2>
<p>In BackBee, a bundle is like an BackBee's core application (<code>BackBee\BBApplication</code>). It can bring its <code>class contents</code>, <code>configurations</code>, <code>listeners</code>, <code>events</code>, <code>templates</code>, <code>controllers</code>, etc. It's surely even more flexible cause you can use bundle loader recipes to change the way things should be loaded. We will talk about this point later.
While the core application contains many features to build up your website/application, a bundle <strong>must</strong> contain only one main functionnality. For example, a ArticleDisqusBundle that brings article content and Disqus commenting feature <strong>must not</strong> exist. A good solution is to split it into two distincts bundles:</p>
<ul>
<li>ArticleBundle: could be a bundle that brings article classcontent and its views, maybe also some listeners to alter some behaviors.</li>
<li>DisqusBundle: could simply be an implementation of Disqus API into BackBee.</li>
</ul>
<p>Also, if one day you need the Disqus feature in another project that doesn't need the article class content, this will result on embedding unused code. So keep it in mind: <strong>one bundle = one feature</strong>.</p>
<h2 id="bundle-folder-structure-and-entry-point">Bundle folder structure and entry point</h2>
<p>A valid bundle should at least have a folder structure that contains an entry point and the <code>Config</code> folder. Considering for this example that our bundle is named NewsletterBundle.</p>
<pre><code>NEWSLETTER_BUNDLE_ROOT_FOLDER
    |_ Config
        |_ config.yml
    |_ Newsletter.php
</code></pre>

<p>The entry point is essential for BackBee to know how load your bundle. Note that the classname does not matter at all (no any standard to follow) but it must implement <code>BackBee\Bundle\BundleInterface</code>. We highly encourage you to extends <code>BackBee\Bundle\AbstractBundle</code> so you have only <code>::start()</code> and <code>::stop()</code> methods to implement to be ready to go. You will find below a simple implementation of these two methods and we will explain to you how BackBee works and loads your bundles:</p>
<pre><code class="php">namespace BackBee\Bundle\NewsletterBundle;

use BackBee\Bundle\AbstractBundle;

class Newsletter extends AbstractBundle
{
    /**
     * {@inheritdoc}
     */
    public function start()
    {
        return $this;
    }

    /**
     * {@inheritdoc}
     */
    public function stop()
    {
        return $this;
    }
}
</code></pre>

<p>Explanation: at the first time the bundle is accessed from application service container, its  <code>::start()</code> method will be invoked (so only once). And <code>::stop()</code> will be invoked on every started bundle when the event <code>bbapplication.stop</code>is dispatched.</p>
<p>The <code>Config/config.yml</code> is also required. It will be parsed to get an instance of <code>BackBee\Config\Config</code>. Here bellow a list of bundle basic configuration parameters:</p>
<pre><code class="yaml"># NEWSLETTER_BUNDLE_ROOT_FOLDER/Config/config.yml
bundle:
    name: NewsLetterBundle
    description: This is a plugin that provide newsletters integration in BackBee
    enable: true # define if the bundle should be load; default: true
    config_per_site: false # allows you to have different configuration per site; default: false
    category: [] # your bundle can belong to none, one or many categories; default: none
    thumbnail: ~ # the thumbnail of your bundle; default: null
</code></pre>

<p>So we saw what's a bundle and what is needed to create one. Let's learn how register it to BackBee. You need to create <code>bundles.yml</code> into your project config folder (generally located at <code>PROJECT_ROOT_DIR/repository/Config/</code>):</p>
<pre><code class="yaml"># PROJECT_ROOT_DIR/repository/Config/bundles.yml
nl: BackBee\Bundle\NewsletterBundle\Newsletter
demo: BackBee\Bundle\DemoBundle\Demo
</code></pre>

<p>That's all! Pretty simple, right? One more thing, bundles are automatically loaded into application service container. Your bundle identifier will always follow this pattern: <code>bundle.__BUNDLE_NAME__</code>. Note that the <code>__BUNDLE_NAME__</code> is the declared key of your bundle, so it's <code>bundle.nl</code> in this case (<code>nl</code> cause it's the key name of the bundle entry point in <code>bundles.yml</code>). You can also access to NewsletterBundle's config from the service container. Its service identifier follow this pattern: <code>bundle.__BUNDLE_NAME__.config</code>. So the NewsletterBundle config identifier is <code>bundle.nl.config</code>.</p>
<p>Well, now you know the basics about BackBee's bundle. Let's get into the next level and learn more about how BackBee loads your bundles!</p>
<h2 id="how-the-bundle-loader-works">How the bundle loader works?</h2>
<p>During the execution of <code>BackBee\BBApplication::__construct</code> many things are done. Within it we have the call to the bundle loader. First, BackBee loads its dependencies like its listeners, services, parameters (into dependency injection container), classcontents, etc. Then BackBee says <em>"Well bundle loader, it's time for you to do your job!"</em>.
The first task the bundle loader do is to get every declared bundle containing by <code>PROJECT_ROOT_DIR/repository/Config/bundles.yml</code> and load them one by one. Note that the order bundles are loaded is determined by declaration order in <code>bundles.yml</code> (in previous example, NewsletterBundle will be loaded first). The order is important cause the last loaded one will always win if there is a conflict about which template to use or which parameter value to use in service container. So <strong>be careful about your bundle declaration order</strong>.</p>
<p>From now, consider that the current path (<code>./</code>) is <code>__BUNDLE_BASE_DIR__</code>. So <code>./Config/</code> is equal to <code>__BUNDLE_BASE_DIR__/Config/</code>.</p>
<h4 id="default-expectations">Default expectations</h4>
<p>We are now coming up to talk about bundle default structure expected by the loader:</p>
<ul>
<li>services for dependency injection container can be declared in yaml or xml format and is expected to be find into <code>./Config/services.[yml|xml]</code></li>
<li>events listeners are expected to be declared in <code>./Config/events.yml</code></li>
<li>routes are expected to be declared in <code>./Config/route.yml</code></li>
<li>classcontent folder is expected to be <code>./ClassContent/</code></li>
<li>templates are expected to be in <code>./Templates/scripts/</code></li>
<li>helpers are expected to be in <code>./Templates/helpers/</code></li>
<li>resources are expected to be in <code>./Resources/</code></li>
</ul>
<p>As long as you follow these standard you won't have anything to do to load your services, events, routes, classcontent, templates, helpers and resources.</p>
<p>Default bundle folder structure:</p>
<pre><code>BUNDLE_ROOT_FOLDER
    |_ ClassContent/
        |_ FakeContent.yml
    |_ Config/
        |_ config.yml
        |_ events.yml
        |_ route.yml
        |_ services.yml
    |_ Resources/
        |_ css/
            |_ fake.css
    |_ Templates/
        |_ helpers/
            |_ fakeHelper.php
        |_ scripts/
            |_ FakeContent.html.twig
    |_ EntryPoint.php

</code></pre>

<h4 id="using-recipes-to-custom-some-load">Using recipes to custom some load</h4>
<p>Admitting that we want to put our templates into <code>./Resources/views/</code> instead of <code>./Templates/scripts/</code> and our helpers into <code>./Renderer/Helper/</code> instead of <code>./Templates/helpers/</code>, how can we do that?
It's pretty simple if you use bundle loader recipes. They allow you use your custom recipe instead of the default one to load some part of your bundle. To load templates and helpers by ourself, simply add these line into <code>./Config/config.yml</code>:</p>
<pre><code class="yaml"># ./Config/config.yml
bundle:
    enable: true
    config_per_site: false
    category: []
    thumbnail: ~
    bundle_loader_recipes:
        helper: [BackBee\Bundle\FakeBundle\EntryPoint, loadHelpers]
        template: [BackBee\Bundle\FakeBundle\EntryPoint, loadTemplates]
</code></pre>

<p>Below an example of how to implements these callbacks into <code>BackBee\Bundle\FakeBundle\EntryPoint</code>:</p>
<pre><code class="php">namespace BackBee\Bundle\FakeBundle;

use BackBee\BBApplication;
use BackBee\Bundle\AbstractBundle;
use BackBee\Config\Config;

class EntryPoint extends AbstractBundle
{
    public static function loadHelpers(BBApplication $app, Config $config)
    {
        $helperDir = __DIR__.DIRECTORY_SEPARATOR.'Renderer'.DIRECTORY_SEPARATOR.'Helper';
        if (!is_dir($helperDir)) {
            $app-&gt;error(sprintf('Unable to load helpers directory (:%s).', $helperDir));
        } else {
            $app-&gt;getRenderer()-&gt;addHelperDir($helperDir);
        }
    }

    public static function loadTemplates(BBApplication $app, Config $config)
    {
        $viewsDir = __DIR__.DIRECTORY_SEPARATOR.'Resources'.DIRECTORY_SEPARATOR.'views';
        if (!is_dir($viewsDir)) {
            $app-&gt;error(sprintf('Unable to load views directory (:%s).', $viewsDir));
        } else {
            $app-&gt;getRenderer()-&gt;addScriptDir($viewsDir);
        }
    }

    /**
     * {@inheritdoc}
     */
    public function start()
    {
        return $this;
    }

    /**
     * {@inheritdoc}
     */
    public function stop()
    {
        return $this;
    }
}
</code></pre>

<p>We just saw how to custom the load of helpers and views. Below the complete list of recipe name bundle loader can interpret:</p>
<ul>
<li><code>classcontent</code></li>
<li><code>custom</code>: use this one if you want to run custom loader without altering default behavior</li>
<li><code>event</code></li>
<li><code>helper</code></li>
<li><code>namespace</code></li>
<li><code>resource</code></li>
<li><code>route</code></li>
<li><code>service</code></li>
<li><code>template</code></li>
</ul>
                <hr />
                <div class="contribution-message">
    <h2>Is something missing?</h2>
    <p>If you notice something we've missed or could be improved on, please follow <a href="https://github.com/backbee/docs/blob/master/README.md" target="_blank">this link</a> and submit a pull request to the BackBee documentation repository. Once we merge it, the changes will be immediately reflected on the website.</p>
</div>
            </div>
        </div>

    <footer>
        <hr>
        <p>Copyright &copy; 2014-2015, <a href="http://www.backbee.com">BackBee project</a>.</p>
        <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>

        <div class="footer-copyright">
            <div class="container">
                <ul class="row nav">
                    <li class="col-sm-6 col-xs-4"><a href=" http://www.lp-digital.fr/en/index.php" target="_blank"><img src="http://backbee.com/img/logo-lpdigital-bw.png" alt="Lp digital"></a></li>
                    <li class="col-sm-6 col-xs-8 text-align-right"><a href=" http://www.lp-digital.fr/en/solutions.php" target="_blank" class="btn btn-dimmed btn-sm">Our other solutions</a><!-- SocialTools -->
                        <div class="social-tool-wrapper">
                            <ul class="nav">
                                <li><a href="https://www.facebook.com/backbeeCMS" target="_blank"><i class="fa fa-facebook"></i><span class="visuallyhidden">Facebook</span></a></li>
                                <li><a href="https://twitter.com/Lpdigitalsystem" target="_blank"><i class="fa fa-twitter"></i><span class="visuallyhidden">Twitter</span></a></li>
                                <li><a href="https://plus.google.com/101416676508957143369/posts" target="_blank"><i class="fa fa-google-plus"></i><span class="visuallyhidden">Google +</span></a></li>
                                <li><a href="http://backbee.com/services/contact-us"><i class="fa fa-envelope"></i><span class="visuallyhidden">Contact Us</span></a></li>
                            </ul>
                        </div>
                        <!-- End SocialTools -->
                    </li>
                </ul>
            </div>
        </div>
    </footer>


        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script src="../../../js/base.js"></script>
    </body>
</html>