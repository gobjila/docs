<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.backbee.com/developer-documentation/components/event_listener/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">

        <title>Event Listener - The BackBee documentation</title>

        <link href="../../../css/gen.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-3459992-27', 'docs.backbee.com');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../.."><img src="../../../img/logo-bb-docs.png" alt="The BackBee documentation" title="The BackBee documentation" height="28" style="vertical-align:bottom;" /> <b>Documentation</b></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">Introduction</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../requirements/">Requirements</a>
                        </li>
                    
                        <li >
                            <a href="../../installation/">Installation</a>
                        </li>
                    
                        <li >
                            <a href="../../architecture/">Architecture</a>
                        </li>
                    
                        <li >
                            <a href="../../configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../../project_architecture/">Project Architecture</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbooks <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../cookbooks/create_bundle_administration/">Create bundle administration</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/create_new_commands/">Create new commands</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/create_new_templating_helpers/">Create new templating helpers</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/customize_error_pages/">Customize error pages</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/ease_debugging_with_profiler/">Ease debugging with the Web Profiler</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/use_swift_mailer_in_backbee/">Use Swift Mailer in BackBee</a>
                        </li>
                    
                        <li >
                            <a href="../../cookbooks/layout_creation/">Layout creation using LayoutBuilderBundle</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../bundle/">Bundle</a>
                        </li>
                    
                        <li >
                            <a href="../cache/">Cache</a>
                        </li>
                    
                        <li >
                            <a href="../classcontent/">ClassContent</a>
                        </li>
                    
                        <li >
                            <a href="../config/">Config</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Event Listener</a>
                        </li>
                    
                        <li >
                            <a href="../nested_node/">Nested Node</a>
                        </li>
                    
                        <li >
                            <a href="../renderer/">Renderer</a>
                        </li>
                    
                        <li >
                            <a href="../routing/">Routing</a>
                        </li>
                    
                        <li >
                            <a href="../security/">Security</a>
                        </li>
                    
                        <li >
                            <a href="../translation/">Translation</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../config/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../nested_node/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/backbee/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container" id="main-container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#components">Components</a></li>
        
            <li><a href="#the-event-listener-component">The Event Listener Component</a></li>
        
            <li><a href="#event">Event</a></li>
        
            <li><a href="#event-listener">Event Listener</a></li>
        
            <li><a href="#event-dispatcher">Event Dispatcher</a></li>
        
            <li><a href="#events-from-class-content-component">Events from Class Content Component</a></li>
        
            <li><a href="#classcontent-listener">ClassContent Listener</a></li>
        
            <li><a href="#event-inheritance">Event inheritance</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
                

<h1 id="components">Components</h1>
<h2 id="the-event-listener-component">The Event Listener Component</h2>
<p><em>Events</em> are a common and effective way to tie together loosely coupled components in an application.
An event is generally used to broadcast a change that has occurred during a process. If a <code>component</code> is
interested in a particular event, it can <em>listen</em> to it. When this particular event is triggered, a <code>method</code>,
often called <em>callback</em> or <em>handler</em> is executed. Events are convenient ways to share
data between components.
In <code>BackBee</code>, events are triggered by an <em>EventDispatcher</em> and an <em>EventListener</em> is used to listen to them.</p>
<h2 id="event">Event</h2>
<p><code>Namespace: BackBee\Event\Event</code></p>
<p>The Backbee event class extend <code>sfEvent</code> and allows us to create a generic <code>Event</code> object.
A generic event object has two properties: <code>target</code> and <code>args</code>;
The target property represents the target of the event. The <code>args</code> is an optional associated map.
When the <code>args</code> property is provided, it's sent to the listeners.
Custom Event can be created by extending the class <code>BackBee\Event\Event</code>.</p>
<pre><code class="php">&lt;?php
$myHelloEvent = new Event($target, array(&quot;message&quot;=&gt;&quot;Hello BackBee&quot;);

</code></pre>

<h2 id="event-listener">Event Listener</h2>
<p><code>Namespace: BackBee\Event\EventListener</code></p>
<p>To listen to an event you must use the <code>addListener</code> method of the <code>EventDispatcher</code>.
<code>addListener</code> takes three parameters. The first one is the name of the event that will be triggered, the second is an array which first element
is a class path and the second is a method. The last parameter is the priority of the event. Listener with higher priority will be triggered first.</p>
<pre><code>$this-&gt;application-&gt;getEventDispatcher()-&gt;addListener("loading.event", array("BackBee/Event/Listener/HelloListener", "sayHello"));
</code></pre>
<p>Here, we register the listener <em>HelloListener</em> to be executed when the event <code>loading.event</code> is occured.</p>
<pre><code class="php">    &lt;?php

        namespace BackBee\Event\Listener;
        use BackBee\Event\Event;

        class HelloListener {

            public static sayHello (Event $event) {

                $dispatcher = $event-&gt;getDispatcher();

                if ($event-&gt;hasArguments(&quot;message&quot;)) {
                    $message = $event-&gt;get(&quot;message&quot;);
                    if ( null !== $dispatcher-&gt;getApplication()) {
                        $dispatcher-&gt;getApplication()-&gt;getLogging()-&gt;notice($message);
                    }
                }
            }
        }

    ?&gt;
</code></pre>

<p>Notice that the event object has access to the <code>application</code> <em>via</em> the <code>EventDispacher</code> and that the <code>sayHello</code> is a <em>static</em> method.</p>
<h2 id="event-dispatcher">Event Dispatcher</h2>
<p><code>Namespace: BackBee\Event\EventListener</code></p>
<p>Events are <em>dispatched</em> or <em>triggered</em> by the <code>EventDispatcher</code> by using the method <code>triggerEvent</code>. The sample bellow shows how to listen to an event.</p>
<p>To trigger an event, we must use the <code>EventDispatcher</code>. It provides, among others, a <code>dispatch</code> method that takes two arguments. A name and an event object.</p>
<pre><code class="php">&lt;?php
    $this-&gt;application-&gt;getEventDispatcher()-&gt;dispatch(&quot;loading.event&quot;, $myHelloEvent);
</code></pre>

<p>When the <em>loading.event</em> is dispatched by the <code>EventDispatcher</code>, all the registered listeners will be executed. In our example,
the static <code>sayHello</code> method of the <code>Backbee/Event/Listener/HelloListener</code> will be called.</p>
<h2 id="events-from-class-content-component">Events from Class Content Component</h2>
<p>One of the main purposes of <code>Backbee</code> is to render contents. As we have seen, 
content is defined in a <code>.yml</code> file. Content creation and content rendering goes
through many phases that <code>Backbee</code> exposes with events. For instance, an event is triggered
when a content is created, before and after a content has been saved, when the rendering process starts, while the content is been rendered, after the renderer process and so on. These events
allow us to act in different ways on the contents lifecycle and rendering process itself.</p>
<p>ClassContent events are similar to custom events. But, as they take place when the main application
is dealing with a request, a common way to listen to them is to use an <code>event.yml</code> config file.
Bellow is an example of how to use the file.</p>
<pre><code class="yaml"># /repository/Config/event.yml
    article.article.render:
        listeners:
            - [BackBee\Event\Listener\ArticleListener, onRender]

    social.facebook.prerender:
        listeners:
            - [BackBee\Event\Listener\Socialistener, PrerenderFacebook]
</code></pre>

<p><code>events.yml</code> is a declarative way to add listeners to <code>ClassContentEvents</code> event. Under the hook,
this yaml file is parsed and the <code>EventDispatcher</code> is used to register the listeners.
In our example,  <code>article.article.render</code> and <code>social.facebook.prerender</code> are events names.
By convention <code>BackBee</code> transforms ClassContent class path to event name. Let's take a look at our events files.</p>
<p>According to our <code>event.yml</code>, the <code>article.article.render</code> event will be triggered when
the content <code>ClassContent/Article/Article.yml</code> is about to be rendered whereas
the 'social.facebook.prerender' will be triggered <em>before</em> the content <code>ClassContent/Social/Facebook.yml</code>
is rendered.
<code>*.render</code>  and <code>*.prerender</code> are events dispatched during the rendering of pahe. Bellow is the list of
all the Renderer events.</p>
<ul>
<li><code>*.prerender</code> : is triggered <em>before</em> the content is being rendered;</li>
<li><code>*.render</code> : when the content is about to be rendered;</li>
<li><code>*.postrender</code> : after the render process.</li>
</ul>
<p>However there is no strong difference between <em>render</em> and <em>postrender</em>.</p>
<p>In BackBee all contents behave like <code>Doctrine</code> entities. These doctrine events are also available for all the contents.</p>
<ul>
<li><code>preremove</code></li>
<li><code>postremove</code></li>
<li><code>postupdate</code></li>
<li><code>preupdate</code></li>
<li><code>update</code></li>
<li><code>prepersist</code></li>
<li><code>postpersist</code></li>
<li><code>postload</code></li>
<li><code>onflush</code></li>
</ul>
<h2 id="classcontent-listener">ClassContent Listener</h2>
<p>To listen to a ClassContentEvent we have to create a <code>Listener</code> class. By default BackBee
will look for Listener in the repository/Config/Listener folder.</p>
<pre><code class="php">    &lt;?php
        namespace BackBee\Event\Listener,
        use BackBee\Event\Event;

        class ArticleListener extends Event {

            public static function onRender(Event $event){
                /* The renderer object */
                $renderer = $event-&gt;getEventArgs();

                /* The eventDispatcher */
                $eventDispatcher = $event-&gt;getDispatcher();

                /* the BackBee application */
                $application = $eventDispatcher-&gt;getApplication();

                /* The article classcontent */
                $content = $renderer-&gt;getObject();

                /* Add a new parameter that will be available in the content template */
                $renderer-&gt;assign('myParams', &quot;my Param value&quot;);
            }
        }
    ?&gt;
</code></pre>

<h2 id="event-inheritance">Event inheritance</h2>
<p>In <code>BackBee</code> content can be inherited from one another. The <code>EventDispatcher</code> respects this inheritance.
If an event is triggered for a subContent it will also be triggered for its parents. So <em>class content</em> Events bubbles up in BackBee.</p>
                <hr />
                <div class="contribution-message">
    <h2>Is something missing?</h2>
    <p>If you notice something we've missed or could be improved on, please follow <a href="https://github.com/backbee/docs/blob/master/README.md" target="_blank">this link</a> and submit a pull request to the BackBee documentation repository. Once we merge it, the changes will be immediately reflected on the website.</p>
</div>
            </div>
        </div>

    <footer>
        <hr>
        <p>Copyright &copy; 2014-2015, <a href="http://www.backbee.com">BackBee project</a>.</p>
        <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>

        <div class="footer-copyright">
            <div class="container">
                <ul class="row nav">
                    <li class="col-sm-6 col-xs-4"><a href=" http://www.lp-digital.fr/en/index.php" target="_blank"><img src="http://backbee.com/img/logo-lpdigital-bw.png" alt="Lp digital"></a></li>
                    <li class="col-sm-6 col-xs-8 text-align-right"><a href=" http://www.lp-digital.fr/en/solutions.php" target="_blank" class="btn btn-dimmed btn-sm">Our other solutions</a><!-- SocialTools -->
                        <div class="social-tool-wrapper">
                            <ul class="nav">
                                <li><a href="https://www.facebook.com/backbeeCMS" target="_blank"><i class="fa fa-facebook"></i><span class="visuallyhidden">Facebook</span></a></li>
                                <li><a href="https://twitter.com/Lpdigitalsystem" target="_blank"><i class="fa fa-twitter"></i><span class="visuallyhidden">Twitter</span></a></li>
                                <li><a href="https://plus.google.com/101416676508957143369/posts" target="_blank"><i class="fa fa-google-plus"></i><span class="visuallyhidden">Google +</span></a></li>
                                <li><a href="http://backbee.com/services/contact-us"><i class="fa fa-envelope"></i><span class="visuallyhidden">Contact Us</span></a></li>
                            </ul>
                        </div>
                        <!-- End SocialTools -->
                    </li>
                </ul>
            </div>
        </div>
    </footer>


        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script src="../../../js/base.js"></script>
    </body>
</html>